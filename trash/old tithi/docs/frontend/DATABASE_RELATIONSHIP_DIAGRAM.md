# ðŸ—ºï¸ Tithi Database Relationship Diagram

## Complete Entity Relationship Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GLOBAL TABLES                               â”‚
â”‚  (No tenant_id - shared across all businesses)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users      â”‚
â”‚              â”‚
â”‚  id (PK)     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  email       â”‚           â”‚
â”‚  password    â”‚           â”‚
â”‚  first_name  â”‚           â”‚
â”‚  last_name   â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  memberships    â”‚  â”‚  tenant_billing        â”‚
         â”‚                 â”‚  â”‚                        â”‚
         â”‚  id (PK)        â”‚  â”‚  id (PK)               â”‚
         â”‚  tenant_id (FK) â”‚â”€â”€â”¼â”€â€º tenant_id (FK)       â”‚
         â”‚  user_id (FK)   â”‚â”€â”€â”˜  stripe_connect_id     â”‚
         â”‚  role           â”‚    subscription_status    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    subscription_id        â”‚
                                 next_billing_date      â”‚
                                     â”‚                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
         â”‚                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TENANTS                                   â”‚
â”‚            (Each business is a tenant)                           â”‚
â”‚                                                                   â”‚
â”‚  id (PK)                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  slug (UNIQUE)                             â”‚                     â”‚
â”‚  name                                      â”‚                     â”‚
â”‚  subdomain                                 â”‚                     â”‚
â”‚  business_timezone                         â”‚                     â”‚
â”‚  logo_url                                  â”‚                     â”‚
â”‚  address_json                              â”‚                     â”‚
â”‚  branding_json                             â”‚                     â”‚
â”‚  status: onboarding/ready/active           â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TENANT-SCOPED TABLES                           â”‚
â”‚         (All have tenant_id FK â†’ tenants.id)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ONBOARDING & CONFIGURATION                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚tenants â”‚â”€â”€â”€â”€â–ºâ”‚ onboarding_progress  â”‚â”€â”€â”€â”€â–ºâ”‚  step_data JSON  â”‚
â”‚        â”‚     â”‚                      â”‚     â”‚  current_step    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚  current_step        â”‚     â”‚  completed_steps â”‚
    â”‚          â”‚  completed_steps     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚          â”‚  step_data           â”‚
    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚   business_branding   â”‚
    â”‚                   â”‚                       â”‚
    â”‚                   â”‚  primary_color        â”‚
    â”‚                   â”‚  secondary_color      â”‚
    â”‚                   â”‚  logo_url             â”‚
    â”‚                   â”‚  font_family          â”‚
    â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚   business_policies   â”‚
    â”‚                   â”‚                       â”‚
    â”‚                   â”‚  cancellation_policy  â”‚
    â”‚                   â”‚  no_show_policy       â”‚
    â”‚                   â”‚  no_show_fee_percent  â”‚
    â”‚                   â”‚  refund_policy        â”‚
    â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CATALOG                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ service_categories  â”‚           â”‚      services          â”‚
â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
â”‚  id (PK)            â”‚           â”‚  id (PK)               â”‚
â”‚  name               â”‚           â”‚  category_id (FK)      â”‚â”€â”€â”€â”
â”‚  color              â”‚           â”‚  name                  â”‚   â”‚
â”‚  sort_order         â”‚           â”‚  duration_min          â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  price_cents           â”‚   â”‚
                                  â”‚  description           â”‚   â”‚
                                  â”‚  instructions          â”‚   â”‚
                                  â”‚  image_url             â”‚   â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                                               â”‚
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   team_member_services           â”‚
                            â”‚                                  â”‚
                            â”‚   service_id (FK)                â”‚
                            â”‚   team_member_id (FK)            â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       TEAM MANAGEMENT                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚team_membersâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ team_member_availability   â”‚
â”‚            â”‚          â”‚                            â”‚
â”‚  id (PK)   â”‚          â”‚  team_member_id (FK)       â”‚
â”‚  name      â”‚          â”‚  service_id (FK)           â”‚
â”‚  email     â”‚          â”‚  day_of_week (1-7)         â”‚
â”‚  bio       â”‚          â”‚  start_time (HH:MM)        â”‚
â”‚  avatar    â”‚          â”‚  end_time (HH:MM)          â”‚
â”‚  role      â”‚          â”‚  is_available              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BOOKING FLOW                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   booking_sessions     â”‚     â”‚   customer_booking_profiles â”‚
â”‚                        â”‚     â”‚                             â”‚
â”‚  session_id            â”‚     â”‚  email                      â”‚
â”‚  current_step          â”‚     â”‚  first_name                 â”‚
â”‚  selected_service_id   â”‚     â”‚  last_name                  â”‚
â”‚  selected_slot         â”‚     â”‚  phone                      â”‚
â”‚  flow_data (JSON)      â”‚     â”‚  marketing_opt_in           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   availability_slots   â”‚     â”‚     customers            â”‚
â”‚                        â”‚     â”‚                          â”‚
â”‚  service_id (FK)       â”‚â”€â”€â”€â” â”‚  id (PK)                 â”‚
â”‚  team_member_id (FK)   â”‚   â”‚ â”‚  display_name            â”‚
â”‚  date                  â”‚   â”‚ â”‚  email                   â”‚
â”‚  start_time            â”‚   â”‚ â”‚  phone                   â”‚
â”‚  end_time              â”‚   â””â”€â”¤  is_first_time           â”‚
â”‚  is_available          â”‚     â”‚  notification_prefs      â”‚
â”‚  is_booked             â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        bookings                                  â”‚
â”‚                                                                   â”‚
â”‚  id (PK)                         â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”
â”‚  customer_id (FK)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â”‚
â”‚  resource_id (FK)  (legacy, use team_member_id)                 â”‚  â”‚
â”‚  start_at                                                       â”‚  â”‚
â”‚  end_at                                                         â”‚  â”‚
â”‚  status: pending/authorized/completed/no_show/canceled          â”‚  â”‚
â”‚  service_snapshot (JSON)                                        â”‚  â”‚
â”‚  no_show_flag                                                   â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                              â”‚                                      â”‚
                              â”‚                                      â”‚
                              â–¼                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚                    booking_items                          â”‚      â”‚
â”‚                                                            â”‚      â”‚
â”‚  booking_id (FK)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  service_id (FK)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  resource_id (FK)                                           â”‚      â”‚
â”‚  start_at                                                   â”‚      â”‚
â”‚  end_at                                                     â”‚      â”‚
â”‚  price_cents                                                â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FINANCIAL                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚bookings  â”‚â”€â”€â”€â”€â–ºâ”‚          payments               â”‚â—„â”€â”€â”€â–ºâ”‚ refunds  â”‚
â”‚          â”‚     â”‚                                 â”‚     â”‚          â”‚
â”‚          â”‚     â”‚  id (PK)                        â”‚     â”‚  id (PK) â”‚
â”‚          â”‚     â”‚  booking_id (FK)                â”‚     â”‚  payment â”‚
â”‚          â”‚     â”‚  customer_id (FK)               â”‚     â”‚  amount  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  amount_cents                   â”‚     â”‚  reason  â”‚
                 â”‚  status: authorized/captured/..  â”‚     â”‚  status  â”‚
                 â”‚  provider_payment_id (Stripe PI) â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚  provider_setup_intent_id        â”‚
                 â”‚  application_fee_cents (1%)       â”‚
                 â”‚  no_show_fee_cents               â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            payment_methods                       â”‚
â”‚                                                  â”‚
â”‚  customer_id (FK)                                â”‚
â”‚  stripe_payment_method_id                        â”‚
â”‚  type: card/apple_pay/...                        â”‚
â”‚  last4                                           â”‚
â”‚  brand                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PROMOTIONS & MARKETING                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   gift_cards     â”‚           â”‚        coupons                   â”‚
â”‚                  â”‚           â”‚                                  â”‚
â”‚  code (UNIQUE)   â”‚           â”‚  code (UNIQUE per tenant)        â”‚
â”‚  amount_cents    â”‚           â”‚  discount_type: % or fixed       â”‚
â”‚  balance_cents   â”‚           â”‚  discount_value                  â”‚
â”‚  expiry_date     â”‚           â”‚  min_amount_cents                â”‚
â”‚  is_active       â”‚           â”‚  usage_limit                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  used_count                      â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     NOTIFICATIONS                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ notification_templates_      â”‚     â”‚  notification_queue_     â”‚
â”‚    enhanced                  â”‚     â”‚      enhanced            â”‚
â”‚                              â”‚     â”‚                          â”‚
â”‚  id (PK)                     â”‚â”€â”€â”€â”€â–ºâ”‚  template_id (FK)        â”‚
â”‚  name                        â”‚     â”‚  trigger_event           â”‚
â”‚  trigger_event               â”‚     â”‚  recipient_email         â”‚
â”‚  category                    â”‚     â”‚  recipient_phone         â”‚
â”‚  subject_template            â”‚     â”‚  subject (processed)     â”‚
â”‚  content_template            â”‚     â”‚  content (processed)     â”‚
â”‚  available_placeholders      â”‚     â”‚  status                  â”‚
â”‚  is_active                   â”‚     â”‚  sent_at                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ANALYTICS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  booking_flow_analytics  â”‚     â”‚  notification_analytics    â”‚
â”‚                          â”‚     â”‚                            â”‚
â”‚  date                    â”‚     â”‚  date                      â”‚
â”‚  sessions_started        â”‚     â”‚  total_sent                â”‚
â”‚  sessions_completed      â”‚     â”‚  delivery_rate             â”‚
â”‚  conversion_rate         â”‚     â”‚  open_rate                 â”‚
â”‚  most_popular_service    â”‚     â”‚  click_rate                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AUDIT & SECURITY                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    audit_logs        â”‚     â”‚  webhook_event_inbox     â”‚
â”‚                      â”‚     â”‚                          â”‚
â”‚  tenant_id (FK)      â”‚     â”‚  tenant_id (FK)          â”‚
â”‚  user_id (FK)        â”‚     â”‚  provider                â”‚
â”‚  action              â”‚     â”‚  event_type              â”‚
â”‚  entity              â”‚     â”‚  payload_json            â”‚
â”‚  diff_json           â”‚     â”‚  processed_at            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Relationship Patterns

### One-to-Many
```
Tenant (1) â”€â”€â–º (N) Customers
Tenant (1) â”€â”€â–º (N) Services
Tenant (1) â”€â”€â–º (N) Team Members
Tenant (1) â”€â”€â–º (N) Bookings
Category (1) â”€â”€â–º (N) Services
Customer (1) â”€â”€â–º (N) Bookings
Service (1) â”€â”€â–º (N) Bookings
Payment (1) â”€â”€â–º (N) Refunds
```

### Many-to-Many
```
Users â†â”€â–º Tenants (via memberships)
Services â†â”€â–º Team Members (via team_member_services)
```

### One-to-One
```
Tenant â”€â”€â–º Onboarding Progress
Tenant â”€â”€â–º Business Branding
Tenant â”€â”€â–º Business Policies
```

---

## Critical Data Flows

### 1. Onboarding Flow
```
User creates account â†’ Creates Tenant â†’ Owner Membership
                    â†“
Onboarding Progress tracks 8 steps
                    â†“
Step 1: tenants.name, description, DBA, category
Step 2: tenants.subdomain
Step 3: tenants.address_json, phone, timezone
Step 4: team_members + team_member_availability
Step 5: business_branding (logo, colors)
Step 6: service_categories + services
Step 7: team_member_availability (availability setup)
Step 8: notification_templates_enhanced
Step 9: business_policies
Step 10: gift_card_templates (optional)
Step 11: tenant_billing (Stripe Connect)
Step 12: Go Live â†’ tenants.status = 'active'
```

### 2. Booking Flow
```
Customer visits {subdomain}.tithi.com
                    â†“
Fetches: tenants, service_categories, services
                    â†“
Selects service â†’ Fetches availability_slots
                    â†“
Selects time â†’ booking_session created
                    â†“
Enters info â†’ booking_session.customer_* updated
                    â†“
Payment â†’ payment created with SetupIntent (save only)
                    â†“
Booking created â†’ status = 'pending'
Customer created (if new)
                    â†“
Confirmation page â†’ Displays booking details
Notification queued â†’ notification_queue_enhanced
```

### 3. Payment Capture Flow
```
Admin clicks "Completed" button
                    â†“
Backend creates PaymentIntent from saved SetupIntent
                    â†“
Charges customer â†’ Stripe API
                    â†“
Updates payment.status = 'captured'
                    â†“
Updates booking.status = 'completed'
                    â†“
Sends confirmation â†’ notification_queue_enhanced
```

### 4. Admin Edit Flow
```
Admin â†’ Settings Tab
              â†“
Can edit ALL onboarding data:
- tenants (business info)
- business_branding (logo, colors)
- business_policies (policies)
- service_categories (categories)
- services (services)
- team_members (staff)
- team_member_availability (availability)
- notification_templates_enhanced (templates)
              â†“
Changes immediately reflected on booking site
```

---

## Data Access Patterns

### Public Booking Site Queries
```sql
-- Get tenant info
SELECT * FROM tenants WHERE subdomain = 'abc-salon';

-- Get services by category
SELECT * FROM services 
JOIN service_categories ON services.category_id = service_categories.id
WHERE services.tenant_id = {tenant_id} AND services.active = true;

-- Get availability slots
SELECT * FROM availability_slots
WHERE service_id = {service_id} 
  AND date >= {start_date}
  AND is_available = true
  AND is_booked = false;

-- Create booking
INSERT INTO bookings (tenant_id, customer_id, service_id, start_at, end_at, status);
INSERT INTO customers (tenant_id, email, display_name, phone);
INSERT INTO payments (tenant_id, booking_id, status, provider_setup_intent_id);
```

### Admin Dashboard Queries
```sql
-- Get all bookings
SELECT b.*, c.display_name, c.email, c.phone, s.name as service_name
FROM bookings b
JOIN customers c ON b.customer_id = c.id
JOIN services s ON b.service_id = s.id
WHERE b.tenant_id = {tenant_id}
  AND b.status = {filter_status}
ORDER BY b.start_at DESC;

-- Get booking details with payment
SELECT b.*, p.*, r.*
FROM bookings b
LEFT JOIN payments p ON p.booking_id = b.id
LEFT JOIN refunds r ON r.booking_id = b.id
WHERE b.id = {booking_id};

-- Capture payment
UPDATE payments 
SET status = 'captured',
    provider_payment_id = {payment_intent_id}
WHERE id = {payment_id};

UPDATE bookings
SET status = 'completed'
WHERE id = {booking_id};
```

---

## Index Usage

**Common index patterns** (backend handles this):
```sql
-- Tenant isolation
CREATE INDEX idx_bookings_tenant ON bookings(tenant_id);

-- Date range queries
CREATE INDEX idx_bookings_start ON bookings(start_at DESC);

-- Status filtering
CREATE INDEX idx_bookings_status ON bookings(status);

-- Customer lookup
CREATE INDEX idx_bookings_customer ON bookings(customer_id);

-- Service lookup
CREATE INDEX idx_bookings_service ON bookings(service_id);

-- Availability queries
CREATE INDEX idx_slots_service_date ON availability_slots(service_id, date);
```

---

**This diagram shows how every table relates. Use it to understand data dependencies when building frontend components.**

